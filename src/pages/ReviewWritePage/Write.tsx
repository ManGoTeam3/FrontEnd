// src/pages/ReviewWritePage/ReviewWritePage.tsx
import React, { useState } from 'react';
// @ts-ignore
import axios from 'axios';
import {Link, useLocation} from 'react-router-dom';
import './Write.scss';
import { useNavigate } from 'react-router-dom';
import Nav from "../../components/Nav/nav";

interface LocationState {
    rating: number;
}

const Write = () => {
    // @ts-ignore
    const navigate = useNavigate();
    // @ts-ignore
    const location = useLocation<LocationState>();
    const [score] = useState<number>(location.state.rating);
    const [reviewContents, setReviewContents] = useState<string>('');
    const [reviewPic, setReviewPic] = useState<File | null>(null);
    const id = location.state.id;
    console.log(id);
    const handleReviewContentsChange = (event: React.ChangeEvent<HTMLTextAreaElement>) => {
        setReviewContents(event.target.value);
    };

    const handleImageUpload = (event: React.ChangeEvent<HTMLInputElement>) => {
        setReviewPic(event.target.files ? event.target.files[0] : null);
    };


    // src/pages/ReviewWritePage/ReviewWritePage.tsx
    const handleSubmit = async (event: React.FormEvent) => {
        event.preventDefault();

        const formData = new FormData();

        // Append ReviewDto as an object
        formData.append('ReviewDto', JSON.stringify({ score: score.toString(), reviewContents }));

        // Convert reviewPic to a binary string
        if (reviewPic) {
            formData.append('reviewPic', reviewPic);
        } else {
            alert('Please upload a review picture!');
            return;
        }
        const token = localStorage.getItem('accessToken');
        try {
            await axios.post(`http://3.217.20.163:8080/api/restaurants/review/${id}`, formData, {
                headers: {
                    'Content-Type': 'multipart/form-data',
                    'Authorization': `Bearer ${token}`
                },
            });
            alert('Review sent successfully!');
            navigate('/Reviewcomplete');
        } catch (error) {
            console.error(error);
            alert('Failed to send review!');
        }
    };

    return (
        <>
        <Nav/>
            <div className={"flexy"}>
                <div>
                    <svg xmlns="http://www.w3.org/2000/svg" width="70" height="70" viewBox="0 0 70 70" fill="none">
                        <circle cx="35" cy="35" r="35" fill="#3DAB60"/>
                        <text x="35" y="40" textAnchor="middle" fill="white" fontSize="30px" dy=".3em">2</text>
                    </svg>

                </div>
                <div>
                    <p className={"txttxt"}>자유롭게 리뷰를 작성해주세요</p>
                </div>
                <form onSubmit={handleSubmit} className="review-form">
                    <label>
                        <textarea className={"ttt"} placeholder={"리뷰를 작성해 주세요!"} value={reviewContents} onChange={handleReviewContentsChange} required/>
                    </label>
                    <label>
                        Review Picture:
                        <input type="file" onChange={handleImageUpload} required/>
                    </label>
                    {
                        score === 5 ? <div>
                            <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 111 111"
                                 fill="none">
                                <path
                                    d="M55.4998 101.482C46.4055 101.482 37.5154 98.7848 29.9537 93.7323C22.3921 88.6797 16.4985 81.4984 13.0182 73.0963C9.53799 64.6942 8.6274 55.4488 10.4016 46.5292C12.1758 37.6097 16.5552 29.4165 22.9858 22.9858C29.4165 16.5552 37.6097 12.1758 46.5292 10.4016C55.4488 8.6274 64.6942 9.53799 73.0963 13.0182C81.4984 16.4985 88.6797 22.3921 93.7323 29.9537C98.7848 37.5154 101.482 46.4055 101.482 55.4998C101.468 67.6908 96.6193 79.3786 87.999 87.999C79.3786 96.6193 67.6908 101.468 55.4998 101.482ZM55.4998 14.1431C47.3202 14.1431 39.3243 16.5686 32.5233 21.113C25.7222 25.6573 20.4214 32.1163 17.2912 39.6733C14.161 47.2303 13.342 55.5457 14.9377 63.5681C16.5335 71.5906 20.4724 78.9596 26.2562 84.7435C32.04 90.5273 39.4091 94.4662 47.4315 96.0619C55.454 97.6577 63.7694 96.8387 71.3264 93.7085C78.8833 90.5783 85.3424 85.2775 89.8867 78.4764C94.4311 71.6753 96.8566 63.6794 96.8566 55.4998C96.8443 44.5351 92.4832 34.023 84.73 26.2697C76.9767 18.5165 66.4646 14.1553 55.4998 14.1431Z"
                                    fill="black"/>
                                <path
                                    d="M77.2051 63.5659C75.4948 67.9303 72.5086 71.6779 68.6363 74.3195C64.7639 76.9611 60.1852 78.3741 55.4976 78.3741C50.8101 78.3741 46.2313 76.9611 42.359 74.3195C38.4866 71.6779 35.5005 67.9303 33.7902 63.5659C32.6386 60.8372 28.6518 63.1913 29.7988 65.9015C31.9227 70.9653 35.4951 75.2888 40.0676 78.3294C44.64 81.3699 50.0088 82.992 55.4999 82.992C60.9911 82.992 66.3598 81.3699 70.9323 78.3294C75.5048 75.2888 79.0772 70.9653 81.2011 65.9015C82.3434 63.1913 78.3613 60.814 77.2051 63.5659Z"
                                    fill="black"/>
                                <path
                                    d="M41.625 47.457C44.8179 47.457 47.4062 44.8687 47.4062 41.6758C47.4062 38.4829 44.8179 35.8945 41.625 35.8945C38.4321 35.8945 35.8438 38.4829 35.8438 41.6758C35.8438 44.8687 38.4321 47.457 41.625 47.457Z"
                                    fill="black"/>
                                <path
                                    d="M69.375 47.457C72.5679 47.457 75.1562 44.8687 75.1562 41.6758C75.1562 38.4829 72.5679 35.8945 69.375 35.8945C66.1821 35.8945 63.5938 38.4829 63.5938 41.6758C63.5938 44.8687 66.1821 47.457 69.375 47.457Z"
                                    fill="black"/>
                            </svg>
                            <p>맛있어요!</p>
                        </div> :
                        score === 3 ? <div>
                                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 111 111"
                                     fill="none">
                                    <path
                                        d="M55.4998 101.482C46.4055 101.482 37.5154 98.7848 29.9537 93.7323C22.3921 88.6797 16.4985 81.4984 13.0182 73.0963C9.53799 64.6942 8.6274 55.4488 10.4016 46.5292C12.1758 37.6097 16.5552 29.4165 22.9858 22.9858C29.4165 16.5552 37.6097 12.1758 46.5292 10.4016C55.4488 8.6274 64.6942 9.53799 73.0963 13.0182C81.4984 16.4985 88.6797 22.3921 93.7323 29.9537C98.7848 37.5154 101.482 46.4055 101.482 55.4998C101.468 67.6908 96.6193 79.3786 87.999 87.999C79.3786 96.6193 67.6908 101.468 55.4998 101.482ZM55.4998 14.1431C47.3202 14.1431 39.3243 16.5686 32.5233 21.113C25.7222 25.6573 20.4214 32.1163 17.2912 39.6733C14.161 47.2303 13.342 55.5457 14.9377 63.5681C16.5335 71.5906 20.4724 78.9596 26.2562 84.7435C32.04 90.5273 39.4091 94.4662 47.4315 96.0619C55.454 97.6577 63.7694 96.8387 71.3264 93.7085C78.8833 90.5783 85.3424 85.2775 89.8867 78.4764C94.4311 71.6753 96.8566 63.6794 96.8566 55.4998C96.8443 44.5351 92.4832 34.023 84.73 26.2697C76.9767 18.5165 66.4646 14.1553 55.4998 14.1431Z"
                                        fill="black"/>
                                    <path
                                        d="M41.6294 47.3599C44.8223 47.3599 47.4106 44.7715 47.4106 41.5786C47.4106 38.3857 44.8223 35.7974 41.6294 35.7974C38.4365 35.7974 35.8481 38.3857 35.8481 41.5786C35.8481 44.7715 38.4365 47.3599 41.6294 47.3599Z"
                                        fill="black"/>
                                    <path
                                        d="M69.3794 47.3599C72.5723 47.3599 75.1606 44.7715 75.1606 41.5786C75.1606 38.3857 72.5723 35.7974 69.3794 35.7974C66.1865 35.7974 63.5981 38.3857 63.5981 41.5786C63.5981 44.7715 66.1865 47.3599 69.3794 47.3599Z"
                                        fill="black"/>
                                    <path
                                        d="M39.0259 73.7178H71.979C72.5923 73.7178 73.1805 73.4741 73.6142 73.0405C74.0479 72.6068 74.2915 72.0186 74.2915 71.4053C74.2915 70.792 74.0479 70.2038 73.6142 69.7701C73.1805 69.3364 72.5923 69.0928 71.979 69.0928H39.0259C38.4126 69.0928 37.8244 69.3364 37.3907 69.7701C36.957 70.2038 36.7134 70.792 36.7134 71.4053C36.7134 72.0186 36.957 72.6068 37.3907 73.0405C37.8244 73.4741 38.4126 73.7178 39.0259 73.7178Z"
                                        fill="black"/>
                                </svg>
                            </div>
                            :
                            <div>
                                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 111 111"
                                     fill="none">
                                    <path
                                        d="M55.4998 101.482C46.4055 101.482 37.5154 98.7848 29.9537 93.7323C22.3921 88.6797 16.4985 81.4984 13.0182 73.0963C9.53799 64.6942 8.6274 55.4488 10.4016 46.5292C12.1758 37.6097 16.5552 29.4165 22.9858 22.9858C29.4165 16.5552 37.6097 12.1758 46.5292 10.4016C55.4488 8.6274 64.6942 9.53799 73.0963 13.0182C81.4984 16.4985 88.6797 22.3921 93.7323 29.9537C98.7848 37.5154 101.482 46.4055 101.482 55.4998C101.468 67.6908 96.6193 79.3786 87.999 87.999C79.3786 96.6193 67.6908 101.468 55.4998 101.482ZM55.4998 14.1431C47.3202 14.1431 39.3243 16.5686 32.5233 21.113C25.7222 25.6573 20.4214 32.1163 17.2912 39.6733C14.161 47.2303 13.342 55.5457 14.9377 63.5681C16.5335 71.5906 20.4724 78.9596 26.2562 84.7435C32.04 90.5273 39.4091 94.4662 47.4315 96.0619C55.454 97.6577 63.7694 96.8387 71.3264 93.7085C78.8833 90.5783 85.3424 85.2775 89.8867 78.4764C94.4311 71.6753 96.8566 63.6794 96.8566 55.4998C96.8443 44.5351 92.4832 34.023 84.73 26.2697C76.9767 18.5165 66.4646 14.1553 55.4998 14.1431Z"
                                        fill="black"/>
                                    <path
                                        d="M79.5779 76.2247C77.1176 72.0234 73.6007 68.539 69.3768 66.1176C65.1529 63.6963 60.3689 62.4224 55.5002 62.4224C50.6315 62.4224 45.8475 63.6963 41.6236 66.1176C37.3996 68.539 33.8828 72.0234 31.4224 76.2247C31.1668 76.7502 31.1196 77.353 31.2903 77.9118C31.4611 78.4707 31.837 78.9442 32.3427 79.2372C32.8483 79.5301 33.4461 79.6208 34.0158 79.4909C34.5856 79.361 35.085 79.0203 35.4138 78.5372C37.4667 75.0335 40.4004 72.1278 43.9237 70.1087C47.4469 68.0896 51.4371 67.0272 55.4979 67.0272C59.5587 67.0272 63.5488 68.0896 67.0721 70.1087C70.5953 72.1278 73.529 75.0335 75.5819 78.5372C75.9069 79.0291 76.4076 79.3784 76.9815 79.5134C77.5555 79.6485 78.1593 79.5593 78.6696 79.264C79.18 78.9686 79.5582 78.4895 79.727 77.9246C79.8959 77.3597 79.8425 76.7516 79.5779 76.2247Z"
                                        fill="black"/>
                                    <path
                                        d="M41.625 47.457C44.8179 47.457 47.4062 44.8687 47.4062 41.6758C47.4062 38.4829 44.8179 35.8945 41.625 35.8945C38.4321 35.8945 35.8438 38.4829 35.8438 41.6758C35.8438 44.8687 38.4321 47.457 41.625 47.457Z"
                                        fill="black"/>
                                    <path
                                        d="M69.375 47.457C72.5679 47.457 75.1562 44.8687 75.1562 41.6758C75.1562 38.4829 72.5679 35.8945 69.375 35.8945C66.1821 35.8945 63.5938 38.4829 63.5938 41.6758C63.5938 44.8687 66.1821 47.457 69.375 47.457Z"
                                        fill="black"/>
                                </svg>
                                <p>별로에요 ㅠ</p>
                            </div>
                    }
                    <button className="btns" type="submit">등록하기</button>
                </form>
            </div>

        </>
    )
        ;
};

export default Write;